<p id="notice"><%= notice %></p>

<div class="row">
  <div class="col-sm-1 col-xs-1">
    <%= link_to(@question.user) do %>
      <%= image_tag(@question.user.image_url, :class => 'list-profile-image') if @question.user.image?     <% end %>
  </div>

  <div class="col-sm-6 col-xs-8">
    <%= link_to(@question.user, :class=> 'link-text') do %>
      <%= @question.user.first_name + " " + @question.user.last_name %> <br/>
    <% end %>

    <%= link_to(@question, :class=> 'link-text') do %>
      <%= @question.content %>
    <% end %>
    <br />

    <span class="category-label category-<%= @question.category.name.downcase[0..2]%>">
      <%= @question.category.name %>
    </span>
  </div>

  <div class="col-sm-2 col-xs-2">
    <%= image_tag 'crystalball.png' %> 
    <span class="metadata-text">
      <%= @question.predictions.count %>
    </span>
  </div>

</div> <!-- End question panel -->

<p>
  <% if @question.options.empty? %>
    No options for the question have been defined.
  <% else %>
    <table>
      <% @question.options.each do |o| %>
      <tr>
        <th><%= image_tag 'qi_gray.png' %></th>
        <td><%= o.content %></td>
        <td>
          <% if @question.predictions.find_by_user_id(session[:user_id]).nil? %>
              <%= link_to "Predict this!",
                          { :controller => 'predictions',
                            :action => 'create',
                            :prediction => { :option_id => o.id,
                                             :user_id => session[:user_id] } },
                          :method => 'POST' %>
          <% end %>
        </td>
      </tr>
      <% if @question.predictions.find_by_user_id(session[:user_id]) %>
      <tr>
	<th>
	</th>
	<td>
	  <% percentile = o.predictions.count.to_f / o.question.predictions.count.to_f * 100 %>
	  <div class="progress">
	    <%= o.predictions.count %>
	    <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%= percentile %>%;">
	    </div>
	  </div>
	</td>
      </tr>
      <% end %>
    <% end %>
    </table>
  <% end %> 
</p>

<%= link_to 'Add Option', :controller => 'options', :action => 'new', :question_id => @question.id %> |
<%= link_to 'Edit', edit_question_path(@question) %> |
<%= link_to 'Back', questions_path %>
